rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Regras para a coleção de casais
    match /couples/{coupleId} {
      // Permitir leitura e escrita apenas se o usuário autenticado for o dono
      allow read, write: if request.auth != null && request.auth.uid == coupleId;
    }
    
    // Regras para a coleção de surpresas
    match /surprises/{surpriseId} {
      // Permitir criar surpresa se estiver autenticado
      allow create: if request.auth != null 
                    && request.resource.data.coupleId is string
                    && request.resource.data.sender is string
                    && request.resource.data.recipient is string
                    && request.resource.data.type is string
                    && request.resource.data.content is string;
      
      // Permitir ler surpresas do próprio casal
      allow read: if request.auth != null 
                  && resource.data.coupleId == request.auth.uid;
      
      // Permitir deletar apenas surpresas do próprio casal
      allow delete: if request.auth != null 
                    && resource.data.coupleId == request.auth.uid;
      
      // Permitir atualizar (marcar como vista, por exemplo)
      allow update: if request.auth != null 
                    && resource.data.coupleId == request.auth.uid;
    }
  }
}